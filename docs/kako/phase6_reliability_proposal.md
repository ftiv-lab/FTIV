# 次期フェーズ改善計画案: Phase 6 "Reliability & Safety Net"

**作成者**: Antigravity (Super Senior Specialist)
**ステータス**: 提案 (Proposal)

## 🎯 目的
`Project Health Report v2` で指摘された **「永続性テストの欠如」** と **「ユーザーによるリカバリ手段の欠如」** を解消し、アプリとしての「堅牢性 (Reliability)」と「安心感 (Safety)」を確立します。
派手な新機能ではありませんが、長く使ってもらうために不可欠な**エンジニアリングの足腰**を鍛えるフェーズです。

## 🛡️ 背景 (Why?)
1.  **設定保存の不安**: 機能追加に伴い設定項目が急増しています（グラデーション、アニメーション等）。これらが「再起動しても確実に元通りになるか」を自動保証する仕組みがありません。
2.  **実験の恐怖**: ユーザーが設定をいじりすぎて「壊れた」と感じた時、コマンドライン (`reset_defaults.py`) を叩かずにアプリ内から初期化できる安全装置が必要です。

## 📋 実施計画 (High Resolution)

### 1. Persistence Integrity (永続性の保証)
「設定変更 → 保存 → **再起動** → 読み込み」のサイクルを保証するE2Eテスト基盤を構築します。

*   **[QA] `test_e2e_persistence.py` の実装**:
    *   **Scenario 1**: テキストを追加し、グラデーションを設定してアプリを閉じる → 再起動 → 同じグラデーションで復元されるか？
    *   **Scenario 2**: ウィンドウ位置を変更してアプリを閉じる → 再起動 → 同じ位置に復元されるか？
    *   **Technical Detail**: `QProcess` を使用して、実際に別プロセスとしてアプリを起動・終了させる「真のE2Eテスト」を試行します（難易度高）。難しければ `SettingsManager` の入出力テストに留めますが、Super Seniorとしてはプロセス起動テストに挑戦すべきです。

### 2. Factory Reset (安全装置の実装)
「設定画面」タブに、エンジニア以外でも使える**初期化ボタン**を設置します。

*   **[Component] `ResetDialog` の作成**:
    *   誤爆防止のため、「本当に初期化しますか？」を確認するモーダルダイアログ。
    *   「初期化して再起動」のアクションフロー。
*   **[Backend] `ResetManager` の実装**:
    *   既存の `scripts/reset_defaults.py` のロジックをクラス化し、アプリ内から安全に呼び出せるようにラップします。
    *   現在の設定ファイルをバックアップ (`config.json.bak`) する機能を追加（優しさ）。
*   **[Experience] 設定タブへの配置**:
    *   「一般 (General)」タブの最下部に「危険地帯 (Danger Zone)」セクションを作成し、赤字のボタンとして配置。

## 📊 期待される成果
1.  **リグレッションの根絶**: 今後いくら設定項目が増えても、保存/復元バグが出ないことを自動テストが保証します。
2.  **ユーザーの心理的安全性**: 「いつでも直せる」という安心感により、ユーザーは積極的にカスタマイズを楽しめるようになります。

## 📅 推奨スケジュール
1.  **Step 1: Persistence Tests** (テストが先。既存の動作を保証してから機能追加)
2.  **Step 2: Reset Logic Wrapper** (スクリプトのクラス化)
3.  **Step 3: Reset UI Integration** (ダイアログとボタンの実装)

この計画で進めることで、FTIVは「多機能なツール」から「信頼できる製品」へと進化します。
