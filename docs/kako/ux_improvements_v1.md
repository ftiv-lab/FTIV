# UX/UI 改善提案書: "First-Time User Experience" (Text Spacing & Defaults)

## 1. 概要 (Overview)
新規ユーザーが初めて FTIV を利用する際、特に「余白・間隔設定」と「その永続化（デフォルト設定）」において感じるであろう「戸惑い」を解消するための改善案です。
**UXデザイナー**、**オンボーディングスペシャリスト**、**QAエンジニア** の3つの視点から分析し、具体的な修正案を提示します。

---

## 2. スペシャリスト分析 (Specialist Analysis)

### 🎨 UX Designer (「直感性」の視点)
> **"なぜ左だけズレているのですか？"**

*   **現状の課題**:
    *   初期設定で `margin_left` が `0.3`、他が `0.0` になっているため、テキストを打った瞬間に「左に謎の空白」があり、中心がズレて見えます。ユーザーはこれを「バグ」か「仕様の理解不足」と感じます。
    *   ダイアログの単位「フォントサイズ比」が伝わりにくい。初心者はピクセルだと思って `10` と入力し、巨大な余白（フォントの10倍）を作ってパニックになります。
*   **改善提案**:
    *   **対称性の確保**: マージン初期値は `0.0` (完全なし) または `0.1` (全周等幅) に統一するべきです。
    *   **単位の明確化**: ラベルに `(文字サイズ比)` や `(1.0 = 1文字分)` というヒントを追記するか、ツールチップを追加します。

### 🔰 Onboarding Specialist (「学習曲線」の視点)
> **"どうやってこれを保存するのですか？"**

*   **現状の課題**:
    *   ユーザーは苦労して設定（フォント、色、余白）を調整しますが、次にアプリを開くとリセットされています。「デフォルトとして保存」機能への導線がダイアログ内に存在せず、コンテキストメニュー（右クリック）の奥深くまで探さないと見つかりません。
*   **改善提案**:
    *   **設定ダイアログ内の導線**: `TextSpacingDialog` やプロパティパネル内に直接 `[デフォルトとして保存]` ボタンを配置します。設定を変えた「その瞬間」に保存できるようにするのが鉄則です。
    *   **Live Preview**: 現在は `OK` を押すまで反映されません。スライダーを動かした瞬間にキャンバス上のテキストが動くようにし、試行錯誤のコストを下げます。

### 🛡️ QA Engineer (「堅牢性・一貫性」の視点)
> **"縦と横で挙動が違いませんか？"**

*   **現状の課題**:
    *   縦書きモード時、`line_spacing_v` が適用されますが、古い `vertical_margin_ratio` とのパラメータの重複や優先順位がコード上で複雑です。
    *   `verify_all.bat` での検証は合格していますが、「マイナス値」を入れた際の重なり挙動（文字同士がめり込む）が、ユーザーの意図しないレベルになる可能性があります。
*   **改善提案**:
    *   **パラメータの正規化**: Configのデフォルト値を整理し、不要なレガシーパラメータ (`horizontal_margin_ratio` 等) を UI からは隠蔽し、内部的に `char_spacing` に一本化します。
    *   **境界値の安全性**: スライダーの最小値を `-0.1` 程度に制限するか（極端なマイナスを避ける）、警告を表示します。

---

## 3. 具体的な修正計画 (Action Plan)

### Phase 1: Defaults & Config (即時修正)
`models/window_config.py` の初期値を変更し、第一印象を改善します。

| パラメータ | 現行値 (Current) | 修正案 (Proposed) | 理由 |
|---|---|---|---|
| `margin_left` | `0.3` | **`0.05`** | 左だけ広い違和感を解消しつつ、窮屈さを避ける微調整。 |
| `margin_right` | `0.0` | **`0.05`** | 左右対称にする。 |
| `margin_top` | `0.0` | **`0.05`** | 上下左右を均一に。 |
| `margin_bottom` | `0.0` | **`0.05`** | 上下左右を均一に。 |
| `line_spacing_h` | `0.5` | `0.5` | 維持（標準的な行間）。 |

### Phase 2: UI Improvement (ダイアログ改修)
`ui/dialogs.py` (`TextSpacingDialog`) をアップデートします。

1.  **リアルタイムプレビュー (Signal Connection)**
    *   スライダー操作時に `valueChanged` シグナルを発火し、親ウィンドウの `update_spacing_realtime` メソッド（新規作成）を呼ぶ。
2.  **永続化ボタンの追加**
    *   ダイアログ下部に `[デフォルト設定として保存]` ボタンを追加。
    *   押下時に `TextActions.save_as_default()` を実行。
3.  **ラベルの親切化**
    *   `jp.json` を更新し、単位の意味を分かりやすくする。

### Phase 3: Property Panel Integration
可能であれば、ダイアログを開かずに調整できる「プロパティパネル」側にも簡易的な余白スライダー（またはプリセットボタン「狭い/普通/広い」）を追加することを検討します（今回はPhase 2までを優先）。

---

## 4. 検証項目

実装後、以下のシナリオで検証を行います。

1.  **Fresh Install Scenario**:
    *   設定ファイルを削除した状態で起動し、新規テキストを作成。
    *   余白が均一で、「中央」に見えるか確認。
2.  **Adjustment Flow**:
    *   ダイアログを開き、スライダーを動かす。
    *   閉じることなく、リアルタイムでテキストの間隔が変わることを確認。
3.  **Persistence Flow**:
    *   ダイアログ内で「デフォルト保存」を押す。
    *   アプリを再起動し、新規テキストを作成。
    *   先ほどの設定が初期状態で適用されていることを確認。

この計画で実装を進めてよろしいでしょうか？
