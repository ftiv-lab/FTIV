# FTIV マインドマップ機能実装に関する技術的批評と今後の展望

**Reviewer**: Super Senior Engineer (Role)
**Date**: 2026-01-25
**Scope**: 現在までの実装コードベース、および Docs 34-37

---

## 1. 総評 (Executive Summary)

**「PoC (概念実証) としては優秀だが、製品としてはまだ "おもちゃ" の域を出ていない」**

PySide6 の `QGraphicsScene` を採用し、カスタムレンダリングとテキスト編集を統合した点は技術選定として正しい。特に `MindMapCanvas` の無限キャンバス実装や `TextRenderer` との統合は評価できる。
しかし、マインドマップツールとしての「本質的な価値」である**思考のスピード**を支える機能（自動レイアウト、爆速ショートカット、AI補完）が欠落、あるいはプリミティブすぎる。
現状は「高機能なノード描画ツール」であり、「思考整理ツール」ではない。

---

## 2. 現状の技術的評価 (Technical Critique)

### 2.1 アーキテクチャ (Architecture)
*   **Good**:
    *   `MindMapData` (Model) と `MindMapNode` (View) の分離は意図されている。
    *   `verify_all.bat` による品質ゲート（Lint/Test/Audit）を導入した姿勢は素晴らしい。この規模でこれをやっているのは稀有。
*   **Bad**:
    *   **God Classの予兆**: `MindMapNode` クラスが描画、イベントハンドリング、設定管理、編集ロジックを抱え込みすぎている。今後「ノードの種類」が増えた瞬間に破綻する。`NodeRenderer` や `InputHandler` に責務を委譲すべき。
    *   **Widget依存**: `MindMapWidget` にショートカットやロジックが直書きされている。`MindMapController` クラスがないため、UIコードとビジネスロジックが密結合している。テストはパスしているが、将来の保守性は低い。

### 2.2 パフォーマンス (Performance)
*   **Concern**:
    *   `paint` メソッド内での計算量は許容範囲だが、`QGraphicsEffect` (影) や `TextRenderer` (オーバーレイ) の多用は、ノード数が1000を超えたあたりでFPS低下を招く。
    *   絵文字対応でフォールバックを設定したのは良い手が、OS依存のレンダリングコストを甘く見てはいけない。

### 2.3 UX/Usability
*   **Critical Missing**:
    *   **自動レイアウト (Auto Layout) がない**: これは致命的。手動でノードを配置しなければならないマインドマップは、紙とペン以下だ。思考を止めないためには、ノードを追加した瞬間に美しく再配置されるアルゴリズム（Reingold-Tilford等）が不可欠。
    *   **ショートカット**: Phase 20 で実装されたが、まだ「標準的」なだけ。FTIVならではの「画像プロパティと連動したショートカット」などが足りない。

---

## 3. ドキュメントレビュー (Docs 34-37)

*   **[34] Implementation Log**:
    *   進捗管理としては機能しているが、「なぜその決定をしたか」の ADR (Architecture Decision Record) が弱い。後任者が「なぜこう書いた？」と迷うだろう。
*   **[35] Market Research**:
    *   競合分析はされているが、「FTIVでやる意味」の深掘りが甘い。既存のXMindやMiroと戦う必要はない。**「画像/動画編集ツールの補助としてのマインドマップ」** という独自の立ち位置をもっと尖らせるべき。
*   **[36] Feasibility**:
    *   技術的実現性は正しかった。しかし開発コストの見積もりが甘かったため、自動レイアウトが後回しになったのではないか。
*   **[37] AI Feasibility**:
    *   ここに未来がある。ただし、「テキスト生成してノード追加」だけでは弱い。**「画像解析結果をマインドマップ化」「動画のタイムライン構造を可視化」** など、マルチモーダルな連携こそがFTIVの勝機。

---

## 4. 今後の展望とロードマップ (Roadmap)

単なる「機能追加」ではなく、プロダクトの価値を高めるフェーズへ移行せよ。

### Phase 21-25: "Brain Speed" (思考速度の向上)
マインドマップとしての基本性能を業界標準レベルに引き上げる。
*   **自動レイアウトの実装**: ノード追加時に重なりを回避し、ツリーを美しく保つ強制レイアウトモードの実装。これが最優先。
*   **スマートナビゲーション**: 矢印キーでの直感的なフォーカス移動。
*   **Markdown Import/Export**: 他ツールとの相互運用性。

### Phase 30+: "FTIV Integration" (独自価値の創出)
FTIV（画像・動画ツール）である必然性を実装する。
*   **画像ノード**: ドラッグ＆ドロップした画像をノード化。サムネイル表示。
*   **プロパティ連動**: ノードを選択すると、それに関連付けられた画像フィルタ設定がプロパティパネルに出る、などの連携。
*   **AI "Vision" Map**: 画像のフォルダを投げると、AIが内容を解析して分類マップを勝手に作る機能。([37]の発展形)

### Phase 50+: "Refactoring or Die"
*   **Render Server分離**: 描画ロジックを完全に別戦略クラスへ。
*   **Command Pattern**: 操作の全てをコマンドオブジェクト化し、堅牢なUndo/Redoとマクロ機能を実現。

---

## 5. 結論

**「土台はできた。次は魂（Soul）を入れろ。」**

コードは綺麗だが、魂（= 自動レイアウトと独自性）がまだない。
次のフェーズでは、コードの綺麗さよりも **UXの圧倒的快感** を追求することを強く推奨する。
